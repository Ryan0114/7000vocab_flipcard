<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Vocabulary Unit</title>
<style>
  body{margin:0;font-family:Arial,sans-serif;background:#0a0f1f;color:#00f0ff;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;}
  header{font-size:2rem;text-align:center;margin-bottom:40px;text-shadow:0 0 5px #00f0ff,0 0 10px #00f0ff,0 0 20px #00f0ff;}
  .flip-card{background:transparent;width:300px;height:150px;perspective:1000px;margin-bottom:20px;position:relative;}
  .flip-card-inner{position:relative;width:100%;height:100%;text-align:center;transform-style:preserve-3d;cursor:pointer;border:2px solid #00f0ff;border-radius:15px;box-shadow:0 0 10px #00f0ff;transition:transform .6s;}
  .flip-card-front,.flip-card-back{position:absolute;width:100%;height:100%;backface-visibility:hidden;display:flex;align-items:center;justify-content:center;font-size:1.2rem;border-radius:15px;padding:10px;box-sizing:border-box;}
  .flip-card-front{background:#0a0f1f;color:#00f0ff;}
  .flip-card-back{background:#00f0ff;color:#0a0f1f;transform:rotateY(180deg);}
  .card-wrapper {
  position: relative;
  width: 300px;                   /* same as the card width */
  height: 170px;                  /* same as the card height */
  margin-bottom: 20px;
  padding-top: 20px;
}

.star {
  position: absolute;
  top: -15px;                     /* slightly above the card */
  left: 0px;
  font-size: 1.5rem;
  cursor: pointer;
  z-index: 10;
  user-select: none;
}
.star.active {
  color: #ffff00;
}



  .controls{display:flex;gap:20px;margin-top:10px;}
  .controls button,.back-button{padding:10px 20px;font-size:1rem;background:#0a0f1f;border:2px solid #00f0ff;color:#00f0ff;cursor:pointer;border-radius:5px;transition:.3s;text-decoration:none;}
  .controls button:hover,.back-button:hover{background:#00f0ff;color:#0a0f1f;box-shadow:0 0 20px #00f0ff;}
  .toggle-language{display:flex;gap:10px;margin-bottom:20px;}
</style>
</head>
<body>

<header id="unit-title">Unit</header>

<div class="toggle-language">
 <label><input type="radio" name="lang" value="eng" checked> Show English</label>
 <label><input type="radio" name="lang" value="zh"> Show Traditional Chinese</label>
</div>

<div class="card-wrapper">
  <span id="star" class="star">☆</span>
  <div class="flip-card" id="vocab-card">
    <div class="flip-card-inner">
      <div class="flip-card-front" id="card-front"></div>
      <div class="flip-card-back" id="card-back"></div>
    </div>
  </div>
</div>


<div class="controls">
 <button onclick="prevCard()">Previous</button>
 <button onclick="nextCard()">Next</button>
</div>

<a href="index.html" class="back-button">Back to Units</a>

<script>
// get url
function getParam(k){
  return new URLSearchParams(window.location.search).get(k);
}

// Get unit parameter
let unit = getParam('unit') || '1';

// If it's a numeric unit, pad single digits with a leading zero
if (!isNaN(unit) && unit !== 'practice') {
  unit = unit.padStart(2, '0'); // e.g., '1' -> '01'
}

// Update the unit title
document.getElementById('unit-title').textContent =
  (unit === 'practice') ? 'Practice (訂正)' :
  (unit.startsWith('adv') ? 'Advanced ' + unit.replace('adv','') : 'Unit ' + parseInt(unit, 10));

let vocab = [], currentIndex = 0, currentLang='eng';

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}


// storage key for marked words
const STORAGE_KEY = "markedWords";

// load marked data from localStorage
function getMarked(){
  return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
}
function setMarked(list){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
}
function isMarked(item){
  const key =  (unit==='practice'? item.unit : unit) + '|' + item.word;
  return getMarked().includes(key);
}
function toggleMark(item){
  const key = (unit==='practice'? item.unit : unit) + '|' + item.word;
  const list = getMarked();
  const idx = list.indexOf(key);
  if(idx>=0) list.splice(idx,1);
  else list.push(key);
  setMarked(list);
  updateStar();
}

// fetch vocab or use practice list
if(unit === 'practice'){
  // build vocab list based on marked items
  const marked = getMarked();
  const tasks = marked.map(k=>{
     const parts = k.split('|');
     return fetch(`units/unit${parts[0]}.json`).then(r=>r.json()).then(js=>{
        const it = js.find(o=>o.word===parts[1]);
        if(it) it.unit = parts[0];
        return it;
     });
  });
  Promise.all(tasks).then(list=>{
     vocab = list.filter(x=>x);
     shuffle(vocab);
     updateCard();
  });
} else {
  fetch(`units/unit${unit}.json`)
    .then(r=>r.json())
    .then(d=>{
      vocab = d;
      shuffle(vocab);
      updateCard();
    });
}

function updateCard(){
  if(!vocab.length) return;
  const item = vocab[currentIndex];
  const front = document.getElementById('card-front');
  const back  = document.getElementById('card-back');
  const inner = document.querySelector('.flip-card-inner');
  // reset  (without animation)
  inner.style.transition='none';
  inner.style.transform='rotateY(0deg)';

  if(currentLang==='eng'){
    front.textContent = item.word;
    back.innerHTML    = item.type.map(t=>`${t.en}. ${t.zh}`).join('<br>');
  } else {
    front.innerHTML   = item.type.map(t=>t.zh).join(' / ');
    back.innerHTML    = item.word + '<br>' + item.type.map(t=>`${t.en}.`).join(' / ');
  }
  void inner.offsetHeight;
  inner.style.transition='transform .6s';

  updateStar();
}
function nextCard(){ if(!vocab.length) return; currentIndex=(currentIndex+1)%vocab.length; updateCard(); }
function prevCard(){ if(!vocab.length) return; currentIndex=(currentIndex-1+vocab.length)%vocab.length; updateCard(); }

// star behavior
function updateStar(){
  const star = document.getElementById('star');
  const item = vocab[currentIndex];
  if(isMarked(item)) star.classList.add("active"), star.textContent="★";
  else star.classList.remove("active"), star.textContent="☆";
}
document.getElementById('star').addEventListener('click',()=>{
  toggleMark(vocab[currentIndex]);
});

// language
document.querySelectorAll('input[name="lang"]').forEach(r=>{
  r.addEventListener('change',e=>{ currentLang=e.target.value; updateCard(); });
});

// flip
document.getElementById('vocab-card').addEventListener('click',e=>{
  if(e.target.id==='star') return; // don't flip when clicking star
  const inner=document.querySelector('.flip-card-inner');
  inner.style.transform = (inner.style.transform==='rotateY(180deg)'?'rotateY(0deg)':'rotateY(180deg)');
});
</script>

</body>
</html>

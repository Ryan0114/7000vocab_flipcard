<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vocabulary Unit</title>
<style>
  body {
    margin: 0;
    font-family: 'Arial', sans-serif;
    background:#0a0f1f;
    color:#00f0ff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
  }
  header {
    font-size:2rem;
    text-align:center;
    margin-bottom:40px;
    text-shadow:0 0 5px #00f0ff,0 0 10px #00f0ff,0 0 20px #00f0ff;
  }
  .flip-card {
    background-color:transparent;
    width:300px;
    height:150px;
    perspective:1000px;
    margin-bottom:20px;
  }
  .flip-card-inner {
    position:relative;
    width:100%;
    height:100%;
    text-align:center;
    transform-style:preserve-3d;
    cursor:pointer;
    border:2px solid #00f0ff;
    border-radius:15px;
    box-shadow:0 0 10px #00f0ff;
    transition:transform 0.6s;
  }
  .flip-card-front,.flip-card-back {
    position:absolute;
    width:100%;
    height:100%;
    backface-visibility:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:1.2rem;
    border-radius:15px;
    padding:10px;
    box-sizing:border-box;
  }
  .flip-card-front {
    background:#0a0f1f;
    color:#00f0ff;
  }
  .flip-card-back {
    background:#00f0ff;
    color:#0a0f1f;
    transform:rotateY(180deg);
  }
  .controls {
    display:flex;
    gap:20px;
    margin-top:10px;
  }
  .controls button,.back-button {
    padding:10px 20px;
    font-size:1rem;
    background:#0a0f1f;
    border:2px solid #00f0ff;
    color:#00f0ff;
    cursor:pointer;
    border-radius:5px;
    transition:0.3s;
    text-decoration:none;
  }
  .controls button:hover,.back-button:hover {
    background:#00f0ff;
    color:#0a0f1f;
    box-shadow:0 0 20px #00f0ff;
  }
  .toggle-language {
    display:flex;
    gap:10px;
    margin-bottom:20px;
  }
</style>
</head>
<body>

<header id="unit-title">Unit</header>

<div class="toggle-language">
  <label><input type="radio" name="lang" value="eng" checked> Show English</label>
  <label><input type="radio" name="lang" value="zh"> Show Traditional Chinese</label>
</div>

<div class="flip-card" id="vocab-card">
  <div class="flip-card-inner">
    <div class="flip-card-front" id="card-front"></div>
    <div class="flip-card-back" id="card-back"></div>
  </div>
</div>

<div class="controls">
  <button onclick="prevCard()">Previous</button>
  <button onclick="nextCard()">Next</button>
</div>

<a href="index.html" class="back-button">Back to Units</a>

<script>
// Get unit number from URL
function getQueryParam(param){
  return new URLSearchParams(window.location.search).get(param);
}
const unitNumber = getQueryParam('unit') || 1;
document.getElementById('unit-title').textContent = 'Unit ' + unitNumber;

let vocab = [];
let currentIndex = 0;
let currentLang = 'eng';

// Shuffle (Fisherâ€“Yates)
function shuffleArray(arr){
  for(let i = arr.length - 1; i > 0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

// Fetch and shuffle
fetch(`units/unit${unitNumber}.json`)
 .then(r=>r.json())
 .then(data=>{
    vocab = data;
    shuffleArray(vocab);
    updateCard();
 })
 .catch(_=>{
    const f = document.getElementById('card-front');
    const b = document.getElementById('card-back');
    f.textContent = 'No vocabulary found';
    b.textContent = '';
 });

// Update the card
function updateCard(){
  if(!vocab.length) return;
  const card = vocab[currentIndex];
  const front  = document.getElementById('card-front');
  const back   = document.getElementById('card-back');
  const inner  = document.querySelector('.flip-card-inner');

  // disable transition and reset orientation
  inner.style.transition = 'none';
  inner.style.transform  = 'rotateY(0deg)';

  if(currentLang === 'eng'){
    // front shows word in English
    front.textContent = card.word;
    // back shows each type: "en. zh"
    back.innerHTML = card.type
      .map(t => `${t.en}. ${t.zh}`)
      .join('<br>');
  }else{
    // front shows the Chinese meaning(s)
    front.innerHTML = card.type.map(t=>t.zh).join(' / ');
    // back shows the English word + type abbreviation list
    back.innerHTML = card.word + '<br>' +
                    card.type.map(t => `${t.en}.`).join(' / ');
  }

  // force reflow to apply transform without animation
  void inner.offsetHeight;
  // re-enable transition for click flip
  inner.style.transition = 'transform 0.6s';
}

function nextCard(){
  if(!vocab.length) return;
  currentIndex = (currentIndex + 1) % vocab.length;
  updateCard();
}

function prevCard(){
  if(!vocab.length) return;
  currentIndex = (currentIndex - 1 + vocab.length) % vocab.length;
  updateCard();
}

// flip on click
document.getElementById('vocab-card').addEventListener('click',()=>{
  const inner = document.querySelector('.flip-card-inner');
  inner.style.transform = inner.style.transform === 'rotateY(180deg)'
                            ? 'rotateY(0deg)'
                            : 'rotateY(180deg)';
});

// change language
document.querySelectorAll('input[name="lang"]').forEach(r=>{
  r.addEventListener('change',(e)=>{
    currentLang = e.target.value;
    updateCard();
  });
});
</script>

</body>
</html>
